<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>mp04 – STA 9750 2024 Submission Material</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">STA 9750 2024 Submission Material</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">mp04</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="mini-project-04-monte-carlo-informed-selection-of-cuny-retirement-plans" class="level1">
<h1>Mini-Project #04: Monte Carlo Informed Selection of CUNY Retirement Plans</h1>
<p><u>Abstract</u></p>
<p>This project evaluates two retirement plans offered to CUNY faculty: the Teachers Retirement System (TRS) and the Optional Retirement Plan (ORP). Through the use of historical financial data, bootstrap inference techniques, and actuarial assumptions, the analysis estimates the probability that one plan outperforms the other, under various scenarios. Key considerations include salary growth, market performance, inflation, and individual risk tolerance. The findings aim to support faculty in making an informed and data-driven decision when choosing between the two retirement plans.</p>
<p><u>Background</u></p>
<p>CUNY offers tow distinct retirement plans for its employees. The first is the Teachers Retirement System (TRS). This plan is a “defined-benefit” plan pension plan, due to the fixed retirement payments guaranteed by the employer, based on the employee’s final average salary and years of service. Once retired, the retiree receives annual cost of living adjustments, based on inflation, capped at 3%. The contribution rates for TRS vary by salary tier.</p>
<p>The second retirement plan option is called the Optional Retirement Plan (ORP). This plan most closely resembles a 401(k) retirement plan, in that is a defined-contribution plan. Employee and employer contributions are invested in mutual funds with age-based asset allocations. Retirement income depends on both market performance and withdrawal strategies. This plan offers the potential for higher returns through compounded growth, but market volatility becomes a risk.</p>
<p>The analysis below evaluates these plans in detail, incorporating data from AlphaVantage and FRED to simulate market returns and inflation trends, and uses computational models to project outcomes over an employee’s career.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reshape2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'reshape2'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:tidyr':

    smiths</code></pre>
</div>
</div>
<section id="task-1-register-for-alphavantage-api-key" class="level2">
<h2 class="anchored" data-anchor-id="task-1-register-for-alphavantage-api-key">Task 1: Register for AlphaVantage API Key</h2>
<p>First, we access <a href=",https://www.alphavantage.co/">AlphaVantage</a>, a commercial stock market data provider. This step involves creating an AlphaVantage free API key. Ir is important to keep this key secure, so the key itself was saved separately in <code>alphavantage_key.txt</code>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">#reading API key in </span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>api_key_file <span class="ot">&lt;-</span> <span class="st">"alphavantage_key.txt"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>alpha_api_key <span class="ot">&lt;-</span> <span class="fu">readLines</span>(api_key_file)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Next, we downloaded the package and loaded library <code>httr2</code>, which is a tool for making HTTP requests in R, which was designed to simplify interactions with APIs.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="task-2-register-for-fred-api-key" class="level2">
<h2 class="anchored" data-anchor-id="task-2-register-for-fred-api-key">Task 2: Register for FRED API Key</h2>
<p>We then access our next data source, <a href="https://fred.stlouisfed.org/">FRED</a>: the Federal Reserve Economic Data repository. The FRED api key is accessed in the same fashion as AlphaVantage, the key itself was saved separately in <code>fred_key.txt</code>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">#reading FRED key in </span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>fred_key_file <span class="ot">&lt;-</span> <span class="st">"fred_key.txt"</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>fred_api_key <span class="ot">&lt;-</span> <span class="fu">readLines</span>(fred_key_file)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="task-3-data-acquisition" class="level2">
<h2 class="anchored" data-anchor-id="task-3-data-acquisition">Task 3: Data Acquisition</h2>
<p>Before beginning the Monte Carlo analysis, we identify and download historical data series for each of the following:</p>
<ul>
<li><p><strong>Wage growth</strong> - this metric is necessary as wage growth determines how an individual’s income evolves over time. We first attempted to access the <strong>Average Hourly Earnings of State and Local Government Employees (</strong><em>series ID: CES9091000003),</em> given CUNY employees are New York State employees, but it was no longer available in the <code>FRED</code> repository.</p>
<p>Instead, we accessed the <strong>Average Hourly Earnings of Production and Nonsupervisory Employees: Total Private</strong> (<em>series ID: CES050000003)</em>. This gives us an alternative to understand wage growth patterns over time, within the private sector, given we were unable to find a puclic sector match. The <code>httr2</code> packages allows us to send the request to the the API and parse the JSON response directly into R. We use a 20 year time period, starting 1/1/2003 and ending 12/31/2003.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">#FRED API base URL</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>fred_base_url <span class="ot">&lt;-</span> <span class="st">"https://api.stlouisfed.org/fred/series/observations"</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co">#FRED API parameters for wage growth data</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>fred_params <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">series_id =</span> <span class="st">"CES0500000003"</span>,  <span class="co">#average Hourly Earnings (Private Sector)</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">api_key =</span> fred_api_key,       </span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">file_type =</span> <span class="st">"json"</span>,           <span class="co"># Response format</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">observation_start =</span> <span class="st">"2003-01-01"</span>,  <span class="co"># Start date</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">observation_end =</span> <span class="st">"2023-12-31"</span>     <span class="co"># End date</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="co">#fetch data</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>resp <span class="ot">&lt;-</span> <span class="fu">request</span>(fred_base_url) <span class="sc">|&gt;</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_url_query</span>(<span class="sc">!!!</span>fred_params) <span class="sc">|&gt;</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_perform</span>()</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a><span class="co">#parse the JSON response into a data frame</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>wage_growth_data <span class="ot">&lt;-</span> <span class="fu">resp_body_json</span>(resp)</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>wage_growth_df <span class="ot">&lt;-</span> wage_growth_data<span class="sc">$</span>observations <span class="sc">|&gt;</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transform</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(date), <span class="at">value =</span> <span class="fu">as.numeric</span>(value))</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the first few rows of the data frame</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">head</span>(wage_growth_df))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  realtime_start realtime_end       date value realtime_start.1 realtime_end.1
1     2024-12-03   2024-12-03 2006-03-01 20.05       2024-12-03     2024-12-03
      date.1 value.1 realtime_start.2 realtime_end.2     date.2 value.2
1 2006-04-01   20.15       2024-12-03     2024-12-03 2006-05-01   20.13
  realtime_start.3 realtime_end.3     date.3 value.3 realtime_start.4
1       2024-12-03     2024-12-03 2006-06-01   20.23       2024-12-03
  realtime_end.4     date.4 value.4 realtime_start.5 realtime_end.5     date.5
1     2024-12-03 2006-07-01   20.29       2024-12-03     2024-12-03 2006-08-01
  value.5 realtime_start.6 realtime_end.6     date.6 value.6 realtime_start.7
1   20.32       2024-12-03     2024-12-03 2006-09-01   20.41       2024-12-03
  realtime_end.7     date.7 value.7 realtime_start.8 realtime_end.8     date.8
1     2024-12-03 2006-10-01   20.43       2024-12-03     2024-12-03 2006-11-01
  value.8 realtime_start.9 realtime_end.9     date.9 value.9 realtime_start.10
1   20.49       2024-12-03     2024-12-03 2006-12-01   20.57        2024-12-03
  realtime_end.10    date.10 value.10 realtime_start.11 realtime_end.11
1      2024-12-03 2007-01-01    20.59        2024-12-03      2024-12-03
     date.11 value.11 realtime_start.12 realtime_end.12    date.12 value.12
1 2007-02-01    20.68        2024-12-03      2024-12-03 2007-03-01    20.73
  realtime_start.13 realtime_end.13    date.13 value.13 realtime_start.14
1        2024-12-03      2024-12-03 2007-04-01    20.78        2024-12-03
  realtime_end.14    date.14 value.14 realtime_start.15 realtime_end.15
1      2024-12-03 2007-05-01    20.84        2024-12-03      2024-12-03
     date.15 value.15 realtime_start.16 realtime_end.16    date.16 value.16
1 2007-06-01    20.95        2024-12-03      2024-12-03 2007-07-01    20.95
  realtime_start.17 realtime_end.17    date.17 value.17 realtime_start.18
1        2024-12-03      2024-12-03 2007-08-01    21.00        2024-12-03
  realtime_end.18    date.18 value.18 realtime_start.19 realtime_end.19
1      2024-12-03 2007-09-01    21.04        2024-12-03      2024-12-03
     date.19 value.19 realtime_start.20 realtime_end.20    date.20 value.20
1 2007-10-01    21.06        2024-12-03      2024-12-03 2007-11-01    21.12
  realtime_start.21 realtime_end.21    date.21 value.21 realtime_start.22
1        2024-12-03      2024-12-03 2007-12-01    21.17        2024-12-03
  realtime_end.22    date.22 value.22 realtime_start.23 realtime_end.23
1      2024-12-03 2008-01-01    21.20        2024-12-03      2024-12-03
     date.23 value.23 realtime_start.24 realtime_end.24    date.24 value.24
1 2008-02-01    21.26        2024-12-03      2024-12-03 2008-03-01    21.36
  realtime_start.25 realtime_end.25    date.25 value.25 realtime_start.26
1        2024-12-03      2024-12-03 2008-04-01    21.38        2024-12-03
  realtime_end.26    date.26 value.26 realtime_start.27 realtime_end.27
1      2024-12-03 2008-05-01    21.47        2024-12-03      2024-12-03
     date.27 value.27 realtime_start.28 realtime_end.28    date.28 value.28
1 2008-06-01    21.51        2024-12-03      2024-12-03 2008-07-01    21.60
  realtime_start.29 realtime_end.29    date.29 value.29 realtime_start.30
1        2024-12-03      2024-12-03 2008-08-01    21.70        2024-12-03
  realtime_end.30    date.30 value.30 realtime_start.31 realtime_end.31
1      2024-12-03 2008-09-01    21.72        2024-12-03      2024-12-03
     date.31 value.31 realtime_start.32 realtime_end.32    date.32 value.32
1 2008-10-01    21.76        2024-12-03      2024-12-03 2008-11-01    21.87
  realtime_start.33 realtime_end.33    date.33 value.33 realtime_start.34
1        2024-12-03      2024-12-03 2008-12-01    21.94        2024-12-03
  realtime_end.34    date.34 value.34 realtime_start.35 realtime_end.35
1      2024-12-03 2009-01-01    21.96        2024-12-03      2024-12-03
     date.35 value.35 realtime_start.36 realtime_end.36    date.36 value.36
1 2009-02-01    21.99        2024-12-03      2024-12-03 2009-03-01    22.06
  realtime_start.37 realtime_end.37    date.37 value.37 realtime_start.38
1        2024-12-03      2024-12-03 2009-04-01    22.09        2024-12-03
  realtime_end.38    date.38 value.38 realtime_start.39 realtime_end.39
1      2024-12-03 2009-05-01    22.11        2024-12-03      2024-12-03
     date.39 value.39 realtime_start.40 realtime_end.40    date.40 value.40
1 2009-06-01    22.14        2024-12-03      2024-12-03 2009-07-01    22.18
  realtime_start.41 realtime_end.41    date.41 value.41 realtime_start.42
1        2024-12-03      2024-12-03 2009-08-01    22.23        2024-12-03
  realtime_end.42    date.42 value.42 realtime_start.43 realtime_end.43
1      2024-12-03 2009-09-01    22.27        2024-12-03      2024-12-03
     date.43 value.43 realtime_start.44 realtime_end.44    date.44 value.44
1 2009-10-01    22.30        2024-12-03      2024-12-03 2009-11-01    22.35
  realtime_start.45 realtime_end.45    date.45 value.45 realtime_start.46
1        2024-12-03      2024-12-03 2009-12-01    22.36        2024-12-03
  realtime_end.46    date.46 value.46 realtime_start.47 realtime_end.47
1      2024-12-03 2010-01-01    22.41        2024-12-03      2024-12-03
     date.47 value.47 realtime_start.48 realtime_end.48    date.48 value.48
1 2010-02-01    22.45        2024-12-03      2024-12-03 2010-03-01    22.46
  realtime_start.49 realtime_end.49    date.49 value.49 realtime_start.50
1        2024-12-03      2024-12-03 2010-04-01    22.49        2024-12-03
  realtime_end.50    date.50 value.50 realtime_start.51 realtime_end.51
1      2024-12-03 2010-05-01    22.53        2024-12-03      2024-12-03
     date.51 value.51 realtime_start.52 realtime_end.52    date.52 value.52
1 2010-06-01    22.53        2024-12-03      2024-12-03 2010-07-01    22.59
  realtime_start.53 realtime_end.53    date.53 value.53 realtime_start.54
1        2024-12-03      2024-12-03 2010-08-01    22.62        2024-12-03
  realtime_end.54    date.54 value.54 realtime_start.55 realtime_end.55
1      2024-12-03 2010-09-01    22.67        2024-12-03      2024-12-03
     date.55 value.55 realtime_start.56 realtime_end.56    date.56 value.56
1 2010-10-01    22.74        2024-12-03      2024-12-03 2010-11-01    22.73
  realtime_start.57 realtime_end.57    date.57 value.57 realtime_start.58
1        2024-12-03      2024-12-03 2010-12-01    22.76        2024-12-03
  realtime_end.58    date.58 value.58 realtime_start.59 realtime_end.59
1      2024-12-03 2011-01-01    22.86        2024-12-03      2024-12-03
     date.59 value.59 realtime_start.60 realtime_end.60    date.60 value.60
1 2011-02-01    22.87        2024-12-03      2024-12-03 2011-03-01    22.87
  realtime_start.61 realtime_end.61    date.61 value.61 realtime_start.62
1        2024-12-03      2024-12-03 2011-04-01    22.91        2024-12-03
  realtime_end.62    date.62 value.62 realtime_start.63 realtime_end.63
1      2024-12-03 2011-05-01    22.98        2024-12-03      2024-12-03
     date.63 value.63 realtime_start.64 realtime_end.64    date.64 value.64
1 2011-06-01    23.01        2024-12-03      2024-12-03 2011-07-01    23.10
  realtime_start.65 realtime_end.65    date.65 value.65 realtime_start.66
1        2024-12-03      2024-12-03 2011-08-01    23.07        2024-12-03
  realtime_end.66    date.66 value.66 realtime_start.67 realtime_end.67
1      2024-12-03 2011-09-01    23.12        2024-12-03      2024-12-03
     date.67 value.67 realtime_start.68 realtime_end.68    date.68 value.68
1 2011-10-01    23.20        2024-12-03      2024-12-03 2011-11-01    23.19
  realtime_start.69 realtime_end.69    date.69 value.69 realtime_start.70
1        2024-12-03      2024-12-03 2011-12-01    23.22        2024-12-03
  realtime_end.70    date.70 value.70 realtime_start.71 realtime_end.71
1      2024-12-03 2012-01-01    23.25        2024-12-03      2024-12-03
     date.71 value.71 realtime_start.72 realtime_end.72    date.72 value.72
1 2012-02-01    23.28        2024-12-03      2024-12-03 2012-03-01    23.36
  realtime_start.73 realtime_end.73    date.73 value.73 realtime_start.74
1        2024-12-03      2024-12-03 2012-04-01    23.39        2024-12-03
  realtime_end.74    date.74 value.74 realtime_start.75 realtime_end.75
1      2024-12-03 2012-05-01    23.40        2024-12-03      2024-12-03
     date.75 value.75 realtime_start.76 realtime_end.76    date.76 value.76
1 2012-06-01    23.46        2024-12-03      2024-12-03 2012-07-01    23.50
  realtime_start.77 realtime_end.77    date.77 value.77 realtime_start.78
1        2024-12-03      2024-12-03 2012-08-01    23.48        2024-12-03
  realtime_end.78    date.78 value.78 realtime_start.79 realtime_end.79
1      2024-12-03 2012-09-01    23.57        2024-12-03      2024-12-03
     date.79 value.79 realtime_start.80 realtime_end.80    date.80 value.80
1 2012-10-01    23.56        2024-12-03      2024-12-03 2012-11-01    23.63
  realtime_start.81 realtime_end.81    date.81 value.81 realtime_start.82
1        2024-12-03      2024-12-03 2012-12-01    23.73        2024-12-03
  realtime_end.82    date.82 value.82 realtime_start.83 realtime_end.83
1      2024-12-03 2013-01-01    23.75        2024-12-03      2024-12-03
     date.83 value.83 realtime_start.84 realtime_end.84    date.84 value.84
1 2013-02-01    23.78        2024-12-03      2024-12-03 2013-03-01    23.80
  realtime_start.85 realtime_end.85    date.85 value.85 realtime_start.86
1        2024-12-03      2024-12-03 2013-04-01    23.87        2024-12-03
  realtime_end.86    date.86 value.86 realtime_start.87 realtime_end.87
1      2024-12-03 2013-05-01    23.89        2024-12-03      2024-12-03
     date.87 value.87 realtime_start.88 realtime_end.88    date.88 value.88
1 2013-06-01    23.96        2024-12-03      2024-12-03 2013-07-01    23.98
  realtime_start.89 realtime_end.89    date.89 value.89 realtime_start.90
1        2024-12-03      2024-12-03 2013-08-01    24.02        2024-12-03
  realtime_end.90    date.90 value.90 realtime_start.91 realtime_end.91
1      2024-12-03 2013-09-01    24.06        2024-12-03      2024-12-03
     date.91 value.91 realtime_start.92 realtime_end.92    date.92 value.92
1 2013-10-01    24.09        2024-12-03      2024-12-03 2013-11-01    24.16
  realtime_start.93 realtime_end.93    date.93 value.93 realtime_start.94
1        2024-12-03      2024-12-03 2013-12-01    24.18        2024-12-03
  realtime_end.94    date.94 value.94 realtime_start.95 realtime_end.95
1      2024-12-03 2014-01-01    24.23        2024-12-03      2024-12-03
     date.95 value.95 realtime_start.96 realtime_end.96    date.96 value.96
1 2014-02-01    24.33        2024-12-03      2024-12-03 2014-03-01    24.32
  realtime_start.97 realtime_end.97    date.97 value.97 realtime_start.98
1        2024-12-03      2024-12-03 2014-04-01    24.34        2024-12-03
  realtime_end.98    date.98 value.98 realtime_start.99 realtime_end.99
1      2024-12-03 2014-05-01    24.40        2024-12-03      2024-12-03
     date.99 value.99 realtime_start.100 realtime_end.100   date.100 value.100
1 2014-06-01    24.46         2024-12-03       2024-12-03 2014-07-01     24.48
  realtime_start.101 realtime_end.101   date.101 value.101 realtime_start.102
1         2024-12-03       2024-12-03 2014-08-01     24.54         2024-12-03
  realtime_end.102   date.102 value.102 realtime_start.103 realtime_end.103
1       2024-12-03 2014-09-01     24.55         2024-12-03       2024-12-03
    date.103 value.103 realtime_start.104 realtime_end.104   date.104 value.104
1 2014-10-01     24.58         2024-12-03       2024-12-03 2014-11-01     24.66
  realtime_start.105 realtime_end.105   date.105 value.105 realtime_start.106
1         2024-12-03       2024-12-03 2014-12-01     24.62         2024-12-03
  realtime_end.106   date.106 value.106 realtime_start.107 realtime_end.107
1       2024-12-03 2015-01-01     24.75         2024-12-03       2024-12-03
    date.107 value.107 realtime_start.108 realtime_end.108   date.108 value.108
1 2015-02-01     24.79         2024-12-03       2024-12-03 2015-03-01     24.86
  realtime_start.109 realtime_end.109   date.109 value.109 realtime_start.110
1         2024-12-03       2024-12-03 2015-04-01     24.89         2024-12-03
  realtime_end.110   date.110 value.110 realtime_start.111 realtime_end.111
1       2024-12-03 2015-05-01     24.97         2024-12-03       2024-12-03
    date.111 value.111 realtime_start.112 realtime_end.112   date.112 value.112
1 2015-06-01     24.97         2024-12-03       2024-12-03 2015-07-01     25.00
  realtime_start.113 realtime_end.113   date.113 value.113 realtime_start.114
1         2024-12-03       2024-12-03 2015-08-01     25.09         2024-12-03
  realtime_end.114   date.114 value.114 realtime_start.115 realtime_end.115
1       2024-12-03 2015-09-01     25.11         2024-12-03       2024-12-03
    date.115 value.115 realtime_start.116 realtime_end.116   date.116 value.116
1 2015-10-01     25.19         2024-12-03       2024-12-03 2015-11-01     25.25
  realtime_start.117 realtime_end.117   date.117 value.117 realtime_start.118
1         2024-12-03       2024-12-03 2015-12-01     25.24         2024-12-03
  realtime_end.118   date.118 value.118 realtime_start.119 realtime_end.119
1       2024-12-03 2016-01-01     25.38         2024-12-03       2024-12-03
    date.119 value.119 realtime_start.120 realtime_end.120   date.120 value.120
1 2016-02-01     25.38         2024-12-03       2024-12-03 2016-03-01     25.45
  realtime_start.121 realtime_end.121   date.121 value.121 realtime_start.122
1         2024-12-03       2024-12-03 2016-04-01     25.53         2024-12-03
  realtime_end.122   date.122 value.122 realtime_start.123 realtime_end.123
1       2024-12-03 2016-05-01     25.58         2024-12-03       2024-12-03
    date.123 value.123 realtime_start.124 realtime_end.124   date.124 value.124
1 2016-06-01     25.62         2024-12-03       2024-12-03 2016-07-01     25.69
  realtime_start.125 realtime_end.125   date.125 value.125 realtime_start.126
1         2024-12-03       2024-12-03 2016-08-01     25.72         2024-12-03
  realtime_end.126   date.126 value.126 realtime_start.127 realtime_end.127
1       2024-12-03 2016-09-01     25.77         2024-12-03       2024-12-03
    date.127 value.127 realtime_start.128 realtime_end.128   date.128 value.128
1 2016-10-01     25.89         2024-12-03       2024-12-03 2016-11-01     25.90
  realtime_start.129 realtime_end.129   date.129 value.129 realtime_start.130
1         2024-12-03       2024-12-03 2016-12-01     25.92         2024-12-03
  realtime_end.130   date.130 value.130 realtime_start.131 realtime_end.131
1       2024-12-03 2017-01-01     26.00         2024-12-03       2024-12-03
    date.131 value.131 realtime_start.132 realtime_end.132   date.132 value.132
1 2017-02-01     26.07         2024-12-03       2024-12-03 2017-03-01     26.11
  realtime_start.133 realtime_end.133   date.133 value.133 realtime_start.134
1         2024-12-03       2024-12-03 2017-04-01     26.17         2024-12-03
  realtime_end.134   date.134 value.134 realtime_start.135 realtime_end.135
1       2024-12-03 2017-05-01     26.21         2024-12-03       2024-12-03
    date.135 value.135 realtime_start.136 realtime_end.136   date.136 value.136
1 2017-06-01     26.26         2024-12-03       2024-12-03 2017-07-01     26.36
  realtime_start.137 realtime_end.137   date.137 value.137 realtime_start.138
1         2024-12-03       2024-12-03 2017-08-01     26.38         2024-12-03
  realtime_end.138   date.138 value.138 realtime_start.139 realtime_end.139
1       2024-12-03 2017-09-01     26.49         2024-12-03       2024-12-03
    date.139 value.139 realtime_start.140 realtime_end.140   date.140 value.140
1 2017-10-01     26.49         2024-12-03       2024-12-03 2017-11-01     26.53
  realtime_start.141 realtime_end.141   date.141 value.141 realtime_start.142
1         2024-12-03       2024-12-03 2017-12-01     26.61         2024-12-03
  realtime_end.142   date.142 value.142 realtime_start.143 realtime_end.143
1       2024-12-03 2018-01-01     26.73         2024-12-03       2024-12-03
    date.143 value.143 realtime_start.144 realtime_end.144   date.144 value.144
1 2018-02-01     26.75         2024-12-03       2024-12-03 2018-03-01     26.86
  realtime_start.145 realtime_end.145   date.145 value.145 realtime_start.146
1         2024-12-03       2024-12-03 2018-04-01     26.91         2024-12-03
  realtime_end.146   date.146 value.146 realtime_start.147 realtime_end.147
1       2024-12-03 2018-05-01     26.98         2024-12-03       2024-12-03
    date.147 value.147 realtime_start.148 realtime_end.148   date.148 value.148
1 2018-06-01     27.04         2024-12-03       2024-12-03 2018-07-01     27.09
  realtime_start.149 realtime_end.149   date.149 value.149 realtime_start.150
1         2024-12-03       2024-12-03 2018-08-01     27.20         2024-12-03
  realtime_end.150   date.150 value.150 realtime_start.151 realtime_end.151
1       2024-12-03 2018-09-01     27.32         2024-12-03       2024-12-03
    date.151 value.151 realtime_start.152 realtime_end.152   date.152 value.152
1 2018-10-01     27.37         2024-12-03       2024-12-03 2018-11-01     27.44
  realtime_start.153 realtime_end.153   date.153 value.153 realtime_start.154
1         2024-12-03       2024-12-03 2018-12-01     27.55         2024-12-03
  realtime_end.154   date.154 value.154 realtime_start.155 realtime_end.155
1       2024-12-03 2019-01-01     27.59         2024-12-03       2024-12-03
    date.155 value.155 realtime_start.156 realtime_end.156   date.156 value.156
1 2019-02-01     27.71         2024-12-03       2024-12-03 2019-03-01     27.80
  realtime_start.157 realtime_end.157   date.157 value.157 realtime_start.158
1         2024-12-03       2024-12-03 2019-04-01     27.78         2024-12-03
  realtime_end.158   date.158 value.158 realtime_start.159 realtime_end.159
1       2024-12-03 2019-05-01     27.86         2024-12-03       2024-12-03
    date.159 value.159 realtime_start.160 realtime_end.160   date.160 value.160
1 2019-06-01     27.95         2024-12-03       2024-12-03 2019-07-01     28.02
  realtime_start.161 realtime_end.161   date.161 value.161 realtime_start.162
1         2024-12-03       2024-12-03 2019-08-01     28.13         2024-12-03
  realtime_end.162   date.162 value.162 realtime_start.163 realtime_end.163
1       2024-12-03 2019-09-01     28.17         2024-12-03       2024-12-03
    date.163 value.163 realtime_start.164 realtime_end.164   date.164 value.164
1 2019-10-01     28.23         2024-12-03       2024-12-03 2019-11-01     28.35
  realtime_start.165 realtime_end.165   date.165 value.165 realtime_start.166
1         2024-12-03       2024-12-03 2019-12-01     28.37         2024-12-03
  realtime_end.166   date.166 value.166 realtime_start.167 realtime_end.167
1       2024-12-03 2020-01-01     28.44         2024-12-03       2024-12-03
    date.167 value.167 realtime_start.168 realtime_end.168   date.168 value.168
1 2020-02-01     28.55         2024-12-03       2024-12-03 2020-03-01     28.77
  realtime_start.169 realtime_end.169   date.169 value.169 realtime_start.170
1         2024-12-03       2024-12-03 2020-04-01     30.01         2024-12-03
  realtime_end.170   date.170 value.170 realtime_start.171 realtime_end.171
1       2024-12-03 2020-05-01     29.72         2024-12-03       2024-12-03
    date.171 value.171 realtime_start.172 realtime_end.172   date.172 value.172
1 2020-06-01     29.38         2024-12-03       2024-12-03 2020-07-01     29.38
  realtime_start.173 realtime_end.173   date.173 value.173 realtime_start.174
1         2024-12-03       2024-12-03 2020-08-01     29.48         2024-12-03
  realtime_end.174   date.174 value.174 realtime_start.175 realtime_end.175
1       2024-12-03 2020-09-01     29.51         2024-12-03       2024-12-03
    date.175 value.175 realtime_start.176 realtime_end.176   date.176 value.176
1 2020-10-01     29.54         2024-12-03       2024-12-03 2020-11-01     29.63
  realtime_start.177 realtime_end.177   date.177 value.177 realtime_start.178
1         2024-12-03       2024-12-03 2020-12-01     29.90         2024-12-03
  realtime_end.178   date.178 value.178 realtime_start.179 realtime_end.179
1       2024-12-03 2021-01-01     29.93         2024-12-03       2024-12-03
    date.179 value.179 realtime_start.180 realtime_end.180   date.180 value.180
1 2021-02-01     30.06         2024-12-03       2024-12-03 2021-03-01     30.06
  realtime_start.181 realtime_end.181   date.181 value.181 realtime_start.182
1         2024-12-03       2024-12-03 2021-04-01     30.21         2024-12-03
  realtime_end.182   date.182 value.182 realtime_start.183 realtime_end.183
1       2024-12-03 2021-05-01     30.39         2024-12-03       2024-12-03
    date.183 value.183 realtime_start.184 realtime_end.184   date.184 value.184
1 2021-06-01     30.54         2024-12-03       2024-12-03 2021-07-01     30.65
  realtime_start.185 realtime_end.185   date.185 value.185 realtime_start.186
1         2024-12-03       2024-12-03 2021-08-01     30.77         2024-12-03
  realtime_end.186   date.186 value.186 realtime_start.187 realtime_end.187
1       2024-12-03 2021-09-01     30.95         2024-12-03       2024-12-03
    date.187 value.187 realtime_start.188 realtime_end.188   date.188 value.188
1 2021-10-01     31.15         2024-12-03       2024-12-03 2021-11-01     31.24
  realtime_start.189 realtime_end.189   date.189 value.189 realtime_start.190
1         2024-12-03       2024-12-03 2021-12-01     31.40         2024-12-03
  realtime_end.190   date.190 value.190 realtime_start.191 realtime_end.191
1       2024-12-03 2022-01-01     31.63         2024-12-03       2024-12-03
    date.191 value.191 realtime_start.192 realtime_end.192   date.192 value.192
1 2022-02-01     31.65         2024-12-03       2024-12-03 2022-03-01     31.84
  realtime_start.193 realtime_end.193   date.193 value.193 realtime_start.194
1         2024-12-03       2024-12-03 2022-04-01     31.95         2024-12-03
  realtime_end.194   date.194 value.194 realtime_start.195 realtime_end.195
1       2024-12-03 2022-05-01     32.08         2024-12-03       2024-12-03
    date.195 value.195 realtime_start.196 realtime_end.196   date.196 value.196
1 2022-06-01     32.20         2024-12-03       2024-12-03 2022-07-01     32.33
  realtime_start.197 realtime_end.197   date.197 value.197 realtime_start.198
1         2024-12-03       2024-12-03 2022-08-01     32.44         2024-12-03
  realtime_end.198   date.198 value.198 realtime_start.199 realtime_end.199
1       2024-12-03 2022-09-01     32.54         2024-12-03       2024-12-03
    date.199 value.199 realtime_start.200 realtime_end.200   date.200 value.200
1 2022-10-01     32.70         2024-12-03       2024-12-03 2022-11-01     32.83
  realtime_start.201 realtime_end.201   date.201 value.201 realtime_start.202
1         2024-12-03       2024-12-03 2022-12-01     32.94         2024-12-03
  realtime_end.202   date.202 value.202 realtime_start.203 realtime_end.203
1       2024-12-03 2023-01-01     33.07         2024-12-03       2024-12-03
    date.203 value.203 realtime_start.204 realtime_end.204   date.204 value.204
1 2023-02-01     33.15         2024-12-03       2024-12-03 2023-03-01     33.31
  realtime_start.205 realtime_end.205   date.205 value.205 realtime_start.206
1         2024-12-03       2024-12-03 2023-04-01     33.44         2024-12-03
  realtime_end.206   date.206 value.206 realtime_start.207 realtime_end.207
1       2024-12-03 2023-05-01     33.54         2024-12-03       2024-12-03
    date.207 value.207 realtime_start.208 realtime_end.208   date.208 value.208
1 2023-06-01     33.70         2024-12-03       2024-12-03 2023-07-01     33.84
  realtime_start.209 realtime_end.209   date.209 value.209 realtime_start.210
1         2024-12-03       2024-12-03 2023-08-01     33.91         2024-12-03
  realtime_end.210   date.210 value.210 realtime_start.211 realtime_end.211
1       2024-12-03 2023-09-01     34.01         2024-12-03       2024-12-03
    date.211 value.211 realtime_start.212 realtime_end.212   date.212 value.212
1 2023-10-01     34.10         2024-12-03       2024-12-03 2023-11-01     34.23
  realtime_start.213 realtime_end.213   date.213 value.213
1         2024-12-03       2024-12-03 2023-12-01     34.34</code></pre>
</div>
</div>
<p>After completing this step and viewing the dataframe in the R environment, it appeared as a list. The below code converts the <code>wage_growth_df</code> to a proper dataframe.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">#extract and convert the observations into a data frame</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>wage_growth_df <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, <span class="fu">lapply</span>(wage_growth_data<span class="sc">$</span>observations, as.data.frame)) <span class="sc">|&gt;</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transform</span>(</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> <span class="fu">as.Date</span>(date),            <span class="co"># Convert 'date' column to Date format</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">value =</span> <span class="fu">as.numeric</span>(value)        <span class="co"># Convert 'value' column to numeric</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co">#drop unnecessary columns</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>wage_growth_df <span class="ot">&lt;-</span> wage_growth_df[, <span class="fu">c</span>(<span class="st">"date"</span>, <span class="st">"value"</span>)]</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="co">#view the structure of the resulting data frame</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(wage_growth_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   214 obs. of  2 variables:
 $ date : Date, format: "2006-03-01" "2006-04-01" ...
 $ value: num  20.1 20.1 20.1 20.2 20.3 ...</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">#display the first few rows</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(wage_growth_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>        date value
1 2006-03-01 20.05
2 2006-04-01 20.15
3 2006-05-01 20.13
4 2006-06-01 20.23
5 2006-07-01 20.29
6 2006-08-01 20.32</code></pre>
</div>
</div></li>
<li><p><strong>Inflation -</strong> we access the <strong>CPI for All Urban Consumers: All Items</strong> (<em>series ID:</em> <em>CPIAUCSL</em>) from FRED, which measures the monthly changes in the price of goods and services purchased by urban customers. The resulting dataframe includes monthly observations of the CPI, formatted into a clean data frame for later analysis.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">#FRED API base URL</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>fred_base_url <span class="ot">&lt;-</span> <span class="st">"https://api.stlouisfed.org/fred/series/observations"</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co">#FRED API parameters for CPI data</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>fred_params <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">series_id =</span> <span class="st">"CPIAUCSL"</span>,            <span class="co"># CPI for All Urban Consumers: All Items</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">api_key =</span> fred_api_key,            <span class="co"># Your API key</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">file_type =</span> <span class="st">"json"</span>,                <span class="co"># Response format</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">observation_start =</span> <span class="st">"2003-01-01"</span>,  <span class="co"># Start date</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">observation_end =</span> <span class="st">"2023-12-31"</span>     <span class="co"># End date</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="co">#fetch CPI data</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>resp <span class="ot">&lt;-</span> <span class="fu">request</span>(fred_base_url) <span class="sc">|&gt;</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_url_query</span>(<span class="sc">!!!</span>fred_params) <span class="sc">|&gt;</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_perform</span>()</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a><span class="co">#parse the JSON response into a data frame</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>cpi_data <span class="ot">&lt;-</span> <span class="fu">resp_body_json</span>(resp)</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>cpi_df <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, <span class="fu">lapply</span>(cpi_data<span class="sc">$</span>observations, as.data.frame)) <span class="sc">|&gt;</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transform</span>(</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> <span class="fu">as.Date</span>(date),            <span class="co"># Convert 'date' column to Date format</span></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">value =</span> <span class="fu">as.numeric</span>(value)        <span class="co"># Convert 'value' column to numeric</span></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a><span class="co">#drop unnecessary columns </span></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>cpi_df <span class="ot">&lt;-</span> cpi_df[, <span class="fu">c</span>(<span class="st">"date"</span>, <span class="st">"value"</span>)]</span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a><span class="co">#view the structure of the resulting data frame</span></span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(cpi_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   252 obs. of  2 variables:
 $ date : Date, format: "2003-01-01" "2003-02-01" ...
 $ value: num  183 184 184 183 183 ...</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">#display the first few rows of the data frame</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(cpi_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>        date value
1 2003-01-01 182.6
2 2003-02-01 183.6
3 2003-03-01 183.9
4 2003-04-01 183.2
5 2003-05-01 182.9
6 2003-06-01 183.1</code></pre>
</div>
</div>
<ul>
<li><p><strong>US Equity Market total returns</strong> - this metric reflects the overall performance of the US stock market, which includes:</p>
<ul>
<li><p>Capital Gains: Price appreciation of stocks or an index</p></li>
<li><p>Dividends: Payments made to shareholders, reinvested for total returns</p></li>
</ul>
<p>We access AlphaVantage’s <code>TIME_SERIES_DAILY_ADJUSTED</code> function which gives us access to the daily stock prices (open, close, high, low), adjusted close prices (adjusted for dividends and stock splits, representing total returns) , and volume.</p>
<p>We use the following code to access <strong>S&amp;P 500 Total Returns (<code>SPY</code></strong>) -</p></li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">#base URL for AlphaVantage API</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>alpha_base_url <span class="ot">&lt;-</span> <span class="st">"https://www.alphavantage.co/query"</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co">#API parameters for SPY</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>test_params <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">function</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"TIME_SERIES_DAILY_ADJUSTED"</span>,  </span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">symbol =</span> <span class="st">"SPY"</span>,                          </span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">apikey =</span> alpha_api_key                 </span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="co">#test request</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>resp <span class="ot">&lt;-</span> <span class="fu">request</span>(alpha_base_url) <span class="sc">|&gt;</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_url_query</span>(<span class="sc">!!!</span>test_params) <span class="sc">|&gt;</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_perform</span>()</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">resp_body_string</span>(resp))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "{\n    \"Information\": \"Thank you for using Alpha Vantage! This is a premium endpoint. You may subscribe to any of the premium plans at https://www.alphavantage.co/premium/ to instantly unlock all premium endpoints\"\n}"</code></pre>
</div>
</div>
<p>Given the output above, we ran into a <strong>premium endpoint</strong>, meaning the TIME_SERIES_DAILY_ADJUSTED function is not available using the free version of AlphaVantage. It is important to note this step involved a bit of trial and error.</p>
<p>We instead access the <code>TIME_SERIES_DAILY</code> data, which gives the <em>unadjusted</em> daily prices. This is not ideal, but will suffice for approximate analysis.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">#define the base URL for AlphaVantage API</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>alpha_base_url <span class="ot">&lt;-</span> <span class="st">"https://www.alphavantage.co/query"</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co">#minimal API parameters for SPY</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>test_params <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">function</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"TIME_SERIES_DAILY"</span>,  <span class="co"># Function to fetch daily prices</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">symbol =</span> <span class="st">"SPY"</span>,                          <span class="co"># S&amp;P 500 ETF</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">apikey =</span> alpha_api_key                    <span class="co"># Your AlphaVantage API key</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="co">#send the test request</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>resp <span class="ot">&lt;-</span> <span class="fu">request</span>(alpha_base_url) <span class="sc">|&gt;</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_url_query</span>(<span class="sc">!!!</span>test_params) <span class="sc">|&gt;</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_perform</span>()</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a><span class="co">#parse the JSON response</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>spy_data <span class="ot">&lt;-</span> <span class="fu">resp_body_json</span>(resp)</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a><span class="co">#extract the daily time series data</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>spy_daily <span class="ot">&lt;-</span> spy_data[[<span class="st">"Time Series (Daily)"</span>]]</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a><span class="co">#convert to a data frame</span></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>spy_df <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, <span class="fu">lapply</span>(<span class="fu">names</span>(spy_daily), <span class="cf">function</span>(date) {</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> <span class="fu">as.Date</span>(date),</span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">close =</span> <span class="fu">as.numeric</span>(spy_daily[[date]][[<span class="st">"4. close"</span>]])</span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>}))</span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a><span class="co">#sort by date</span></span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>spy_df <span class="ot">&lt;-</span> spy_df[<span class="fu">order</span>(spy_df<span class="sc">$</span>date), ]</span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a><span class="co">#view the resulting data frame</span></span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(spy_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   100 obs. of  2 variables:
 $ date : Date, format: "2024-07-16" "2024-07-17" ...
 $ close: num  565 557 553 549 555 ...</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(spy_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>          date  close
100 2024-07-16 564.86
99  2024-07-17 556.94
98  2024-07-18 552.66
97  2024-07-19 548.99
96  2024-07-22 554.65
95  2024-07-23 553.78</code></pre>
</div>
</div>
<p>We also access the <strong>S&amp;P 500 Index</strong> time seriesfrom FRED, which provides daily index values from 2003 to 2023.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the base URL for the FRED API</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>fred_base_url <span class="ot">&lt;-</span> <span class="st">"https://api.stlouisfed.org/fred/series/observations"</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Define API parameters for US equity market (S&amp;P 500 Index as an alternative to Wilshire 5000)</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>fred_params_us <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">series_id =</span> <span class="st">"SP500"</span>,              <span class="co"># S&amp;P 500 Index series ID</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">api_key =</span> fred_api_key,           <span class="co"># Your FRED API key</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">file_type =</span> <span class="st">"json"</span>,               <span class="co"># Response format</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">observation_start =</span> <span class="st">"2003-01-01"</span>, <span class="co"># Start date</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">observation_end =</span> <span class="st">"2023-12-31"</span>    <span class="co"># End date</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Fetch the data from FRED API</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>resp <span class="ot">&lt;-</span> <span class="fu">request</span>(fred_base_url) <span class="sc">|&gt;</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_url_query</span>(<span class="sc">!!!</span>fred_params_us) <span class="sc">|&gt;</span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_perform</span>()</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Parse the JSON response</span></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>us_equity_data <span class="ot">&lt;-</span> <span class="fu">resp_body_json</span>(resp)</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the observations list into a clean dataframe</span></span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>us_equity_df <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, <span class="fu">lapply</span>(us_equity_data<span class="sc">$</span>observations, <span class="cf">function</span>(x) {</span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> <span class="fu">as.Date</span>(x<span class="sc">$</span>date),                  <span class="co"># Convert 'date' to Date format</span></span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">us_equity =</span> <span class="fu">as.numeric</span>(<span class="fu">ifelse</span>(x<span class="sc">$</span>value <span class="sc">==</span> <span class="st">"."</span>, <span class="cn">NA</span>, x<span class="sc">$</span>value)), <span class="co"># Handle "." as NA</span></span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>                <span class="co"># Avoid unnecessary factor conversion</span></span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>}))</span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop rows with NA values if necessary</span></span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a>us_equity_df <span class="ot">&lt;-</span> us_equity_df[<span class="sc">!</span><span class="fu">is.na</span>(us_equity_df<span class="sc">$</span>us_equity), ]</span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify the structure and content of the dataframe</span></span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(us_equity_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   2287 obs. of  2 variables:
 $ date     : Date, format: "2014-11-28" "2014-12-01" ...
 $ us_equity: num  2068 2053 2067 2074 2072 ...</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(us_equity_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>        date us_equity
1 2014-11-28   2067.56
2 2014-12-01   2053.44
3 2014-12-02   2066.55
4 2014-12-03   2074.33
5 2014-12-04   2071.92
6 2014-12-05   2075.37</code></pre>
</div>
</div></li>
<li><p><strong>International Equity Market total returns</strong> - this metric provides insight into the benefits of global diversification. Investing outside of the US allows for exposure into different economies and sectors, which reduces dependency on the domestic market. One popular index for markets outside of North America is the <strong>MSCI EAFE</strong>, which is tracked by the <strong>EFA</strong> (MSCI EAFE) ETF.</p>
<p>By analyzing international equity market returns, we can model how investments in global stocks could impact long-term retirement outcomes, especially when paired with US data.</p>
<p>We run the following code to access International Equity Data using AlphaVantage.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the base URL for AlphaVantage API</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>alpha_base_url <span class="ot">&lt;-</span> <span class="st">"https://www.alphavantage.co/query"</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Minimal API parameters for EFA (MSCI EAFE ETF)</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>efa_params <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">function</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"TIME_SERIES_DAILY"</span>,  <span class="co"># Function to fetch daily prices</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">symbol =</span> <span class="st">"EFA"</span>,                   <span class="co"># MSCI EAFE ETF</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">apikey =</span> alpha_api_key             <span class="co"># Your AlphaVantage API key</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Send the request</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>resp <span class="ot">&lt;-</span> <span class="fu">request</span>(alpha_base_url) <span class="sc">|&gt;</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_url_query</span>(<span class="sc">!!!</span>efa_params) <span class="sc">|&gt;</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_perform</span>()</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Parse the JSON response</span></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>efa_data <span class="ot">&lt;-</span> <span class="fu">resp_body_json</span>(resp)</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the daily time series data</span></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>efa_daily <span class="ot">&lt;-</span> efa_data[[<span class="st">"Time Series (Daily)"</span>]]</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to a data frame</span></span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>efa_df <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, <span class="fu">lapply</span>(<span class="fu">names</span>(efa_daily), <span class="cf">function</span>(date) {</span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> <span class="fu">as.Date</span>(date),</span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">close =</span> <span class="fu">as.numeric</span>(efa_daily[[date]][[<span class="st">"4. close"</span>]])</span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>}))</span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort by date</span></span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a>efa_df <span class="ot">&lt;-</span> efa_df[<span class="fu">order</span>(efa_df<span class="sc">$</span>date), ]</span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a><span class="co"># View the resulting data frame</span></span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(efa_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   100 obs. of  2 variables:
 $ date : Date, format: "2024-07-16" "2024-07-17" ...
 $ close: num  81.2 80.8 80 79.5 80.4 ...</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(efa_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>          date close
100 2024-07-16 81.25
99  2024-07-17 80.82
98  2024-07-18 80.02
97  2024-07-19 79.53
96  2024-07-22 80.37
95  2024-07-23 79.92</code></pre>
</div>
</div>
<p>The code above proceeds to use the TIME_SERIES_DAILY endpoint to grab daily prices for the EFA ETF, parameters are specified and the request is sent to the AlphaVantage API, the Time Series (Daily) section of the JSON response is extracted, a data frame is created with the date and closing price columns, sorted by date.</p>
<blockquote class="blockquote">
<p>Note: One limitation of using AlphaVantage’s free content is we cannot go back 15-20 years in every sector, as we might hope, as find easier when using FRED.</p>
</blockquote>
<p>US equity data typically calculates logarithmic returns. To transform this data so it may be compared against US equity returns, or incorporated into Monte Carlo simulations, we calculate the logarithmic returns as follows:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>efa_df <span class="ot">&lt;-</span> efa_df <span class="sc">|&gt;</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transform</span>(<span class="at">return =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="fu">diff</span>(<span class="fu">log</span>(close))))</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(efa_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>          date close       return
100 2024-07-16 81.25           NA
99  2024-07-17 80.82 -0.005306362
98  2024-07-18 80.02 -0.009947856
97  2024-07-19 79.53 -0.006142294
96  2024-07-22 80.37  0.010506663
95  2024-07-23 79.92 -0.005614838</code></pre>
</div>
</div>
<p>We can also use FRED to access the <strong>ICE BofA Emerging Markets Corporate Plus Index Total Return Index Value</strong>. This index measures the total returns of emerging market corporate bonds. We use this dataset as a proxy for international equity market performance because it captures returns in emerging markets, which, similar to equity investments, have hgiher risk and growth potential.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define FRED API base URL</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>fred_base_url <span class="ot">&lt;-</span> <span class="st">"https://api.stlouisfed.org/fred/series/observations"</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co"># FRED API parameters for the selected international equity index</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>fred_params_int <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">series_id =</span> <span class="st">"BAMLEMCBPITRIV"</span>,         <span class="co"># International Equity Market Index</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">api_key =</span> fred_api_key,               <span class="co"># Your FRED API key</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">file_type =</span> <span class="st">"json"</span>,                   <span class="co"># Response format</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">observation_start =</span> <span class="st">"2003-01-01"</span>,     <span class="co"># Start date</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">observation_end =</span> <span class="st">"2023-12-31"</span>        <span class="co"># End date</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Fetch international equity market data</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>resp <span class="ot">&lt;-</span> <span class="fu">request</span>(fred_base_url) <span class="sc">|&gt;</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_url_query</span>(<span class="sc">!!!</span>fred_params_int) <span class="sc">|&gt;</span></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_perform</span>()</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Parse the JSON response into a data frame</span></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>int_equity_data <span class="ot">&lt;-</span> <span class="fu">resp_body_json</span>(resp)</span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>int_equity_df <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, <span class="fu">lapply</span>(int_equity_data<span class="sc">$</span>observations, as.data.frame)) <span class="sc">|&gt;</span></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transform</span>(</span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> <span class="fu">as.Date</span>(date),             <span class="co"># Convert 'date' column to Date format</span></span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">value =</span> <span class="fu">as.numeric</span>(value)        <span class="co"># Convert 'value' column to numeric</span></span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in eval(substitute(list(...)), `_data`, parent.frame()): NAs introduced
by coercion</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop unnecessary columns and rename</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>int_equity_df <span class="ot">&lt;-</span> int_equity_df[, <span class="fu">c</span>(<span class="st">"date"</span>, <span class="st">"value"</span>)] <span class="sc">|&gt;</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">int_equity =</span> value)          <span class="co"># Rename 'value' column to 'int_equity'</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="co"># View the structure of the resulting data frame</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(int_equity_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   5548 obs. of  2 variables:
 $ date      : Date, format: "2003-01-01" "2003-01-02" ...
 $ int_equity: num  NA 144 144 145 145 ...</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the first few rows of the data frame</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(int_equity_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>        date int_equity
1 2003-01-01         NA
2 2003-01-02     144.36
3 2003-01-03     144.43
4 2003-01-06     144.53
5 2003-01-07     145.01
6 2003-01-08     145.50</code></pre>
</div>
</div>
<p>The code below replaces missing values with <code>NA</code></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>int_equity_df<span class="sc">$</span>int_equity <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">ifelse</span>(int_equity_df<span class="sc">$</span>int_equity <span class="sc">==</span> <span class="st">"."</span>, <span class="cn">NA</span>, int_equity_df<span class="sc">$</span>int_equity))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>This code replaces NA with the last valid observation.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(zoo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'zoo'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    as.Date, as.Date.numeric</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>int_equity_df<span class="sc">$</span>int_equity <span class="ot">&lt;-</span> <span class="fu">na.locf</span>(int_equity_df<span class="sc">$</span>int_equity, <span class="at">na.rm =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Aggregating to monthly data -</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>int_equity_monthly <span class="ot">&lt;-</span> int_equity_df <span class="sc">|&gt;</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">format</span>(date, <span class="st">"%Y-%m"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(month) <span class="sc">|&gt;</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">int_equity =</span> <span class="fu">mean</span>(int_equity, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(<span class="fu">paste0</span>(month, <span class="st">"-01"</span>), <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>month)  <span class="co">#dropping month - realized later on we did not need it so modifying this step</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a><span class="co">#checking the structure of the modified dataset</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(int_equity_monthly)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [252 × 2] (S3: tbl_df/tbl/data.frame)
 $ int_equity: num [1:252] 146 148 149 151 157 ...
 $ date      : Date[1:252], format: "2003-01-01" "2003-02-01" ...</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co">#previewing the first few rows</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(int_equity_monthly)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
  int_equity date      
       &lt;dbl&gt; &lt;date&gt;    
1       146. 2003-01-01
2       148. 2003-02-01
3       149. 2003-03-01
4       151. 2003-04-01
5       157. 2003-05-01
6       161. 2003-06-01</code></pre>
</div>
</div></li>
<li><p><strong>Bond market total returns</strong> - this financial metric provides insight into fixed-income investments. These are typically less volatile compared to equities, and serve as a method to stabilize a portfolio. Bonds offer a predictable income stream and can hedge against stock market downturns. Bonds serve as a safe and stable portion of a portfolio as one plans for retirement.</p>
<p>We access FRED’s <code>10-Year Treasury Constant Maturity Rate</code>, for 2003-2023.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the base URL for FRED API</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>fred_base_url <span class="ot">&lt;-</span> <span class="st">"https://api.stlouisfed.org/fred/series/observations"</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="co"># FRED API parameters for 10-Year Treasury Rate</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>fred_params <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">series_id =</span> <span class="st">"GS10"</span>,               <span class="co"># 10-Year Treasury Constant Maturity Rate</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">api_key =</span> fred_api_key,           <span class="co"># Your FRED API key</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">file_type =</span> <span class="st">"json"</span>,               <span class="co"># Response format</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">observation_start =</span> <span class="st">"2003-01-01"</span>, <span class="co"># Start date</span></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">observation_end =</span> <span class="st">"2023-12-31"</span>    <span class="co"># End date</span></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Send the request</span></span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>resp <span class="ot">&lt;-</span> <span class="fu">request</span>(fred_base_url) <span class="sc">|&gt;</span></span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_url_query</span>(<span class="sc">!!!</span>fred_params) <span class="sc">|&gt;</span></span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_perform</span>()</span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Parse the JSON response</span></span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a>bond_data <span class="ot">&lt;-</span> <span class="fu">resp_body_json</span>(resp)</span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract and convert the observations into a data frame</span></span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a>bond_df <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, <span class="fu">lapply</span>(bond_data<span class="sc">$</span>observations, as.data.frame)) <span class="sc">|&gt;</span></span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transform</span>(</span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> <span class="fu">as.Date</span>(date),            <span class="co"># Convert 'date' column to Date format</span></span>
<span id="cb52-26"><a href="#cb52-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">value =</span> <span class="fu">as.numeric</span>(value)        <span class="co"># Convert 'value' column to numeric</span></span>
<span id="cb52-27"><a href="#cb52-27" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb52-28"><a href="#cb52-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-29"><a href="#cb52-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop unnecessary columns</span></span>
<span id="cb52-30"><a href="#cb52-30" aria-hidden="true" tabindex="-1"></a>bond_df <span class="ot">&lt;-</span> bond_df[, <span class="fu">c</span>(<span class="st">"date"</span>, <span class="st">"value"</span>)]</span>
<span id="cb52-31"><a href="#cb52-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-32"><a href="#cb52-32" aria-hidden="true" tabindex="-1"></a><span class="co"># View the structure of the resulting data frame</span></span>
<span id="cb52-33"><a href="#cb52-33" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(bond_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   252 obs. of  2 variables:
 $ date : Date, format: "2003-01-01" "2003-02-01" ...
 $ value: num  4.05 3.9 3.81 3.96 3.57 3.33 3.98 4.45 4.27 4.29 ...</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the first few rows</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(bond_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>        date value
1 2003-01-01  4.05
2 2003-02-01  3.90
3 2003-03-01  3.81
4 2003-04-01  3.96
5 2003-05-01  3.57
6 2003-06-01  3.33</code></pre>
</div>
</div>
<p>With the hope to later analyze returns, we can calculate <strong>monthly percentage changes</strong>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>bond_df <span class="ot">&lt;-</span> bond_df <span class="sc">|&gt;</span> </span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transform</span>(<span class="at">return =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="fu">diff</span>(<span class="fu">log</span>(value))))</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="co"># View the first few rows with returns</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(bond_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>        date value      return
1 2003-01-01  4.05          NA
2 2003-02-01  3.90 -0.03774033
3 2003-03-01  3.81 -0.02334736
4 2003-04-01  3.96  0.03861484
5 2003-05-01  3.57 -0.10367843
6 2003-06-01  3.33 -0.06959329</code></pre>
</div>
</div></li>
<li><p><strong>Short-term debt returns</strong> - reflect the interest earned on safe, short-term fixed-income securities. One commonly used financial instrument here is the <strong>Treasury Bill</strong>. When planning for retirement, short-term debt can serve as a buffer for market volatility.</p>
<p>Below we access FRED’s <strong>3-Month Treasury Bill Rate</strong>, with a resulting data frame, <code>t_bill_df</code>, which contains short-term debt rate data from 2003-2023.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the base URL for FRED API</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>fred_base_url <span class="ot">&lt;-</span> <span class="st">"https://api.stlouisfed.org/fred/series/observations"</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="co"># FRED API parameters for 3-Month Treasury Bill Rate</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>fred_params <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">series_id =</span> <span class="st">"TB3MS"</span>,               <span class="co"># 3-Month Treasury Bill Rate</span></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">api_key =</span> fred_api_key,            <span class="co"># Your FRED API key</span></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">file_type =</span> <span class="st">"json"</span>,                <span class="co"># Response format</span></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">observation_start =</span> <span class="st">"2003-01-01"</span>,  <span class="co"># Start date</span></span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">observation_end =</span> <span class="st">"2023-12-31"</span>     <span class="co"># End date</span></span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Send the request</span></span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a>resp <span class="ot">&lt;-</span> <span class="fu">request</span>(fred_base_url) <span class="sc">|&gt;</span></span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_url_query</span>(<span class="sc">!!!</span>fred_params) <span class="sc">|&gt;</span></span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_perform</span>()</span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-18"><a href="#cb58-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Parse the JSON response</span></span>
<span id="cb58-19"><a href="#cb58-19" aria-hidden="true" tabindex="-1"></a>t_bill_data <span class="ot">&lt;-</span> <span class="fu">resp_body_json</span>(resp)</span>
<span id="cb58-20"><a href="#cb58-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-21"><a href="#cb58-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract and convert the observations into a data frame</span></span>
<span id="cb58-22"><a href="#cb58-22" aria-hidden="true" tabindex="-1"></a>t_bill_df <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, <span class="fu">lapply</span>(t_bill_data<span class="sc">$</span>observations, as.data.frame)) <span class="sc">|&gt;</span></span>
<span id="cb58-23"><a href="#cb58-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb58-24"><a href="#cb58-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transform</span>(</span>
<span id="cb58-25"><a href="#cb58-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> <span class="fu">as.Date</span>(date),             <span class="co"># Convert 'date' column to Date format</span></span>
<span id="cb58-26"><a href="#cb58-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">value =</span> <span class="fu">as.numeric</span>(value)         <span class="co"># Convert 'value' column to numeric</span></span>
<span id="cb58-27"><a href="#cb58-27" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb58-28"><a href="#cb58-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-29"><a href="#cb58-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop unnecessary columns</span></span>
<span id="cb58-30"><a href="#cb58-30" aria-hidden="true" tabindex="-1"></a>t_bill_df <span class="ot">&lt;-</span> t_bill_df[, <span class="fu">c</span>(<span class="st">"date"</span>, <span class="st">"value"</span>)]</span>
<span id="cb58-31"><a href="#cb58-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-32"><a href="#cb58-32" aria-hidden="true" tabindex="-1"></a><span class="co"># View the structure of the resulting data frame</span></span>
<span id="cb58-33"><a href="#cb58-33" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(t_bill_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   252 obs. of  2 variables:
 $ date : Date, format: "2003-01-01" "2003-02-01" ...
 $ value: num  1.17 1.17 1.13 1.13 1.07 0.92 0.9 0.95 0.94 0.92 ...</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the first few rows</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(t_bill_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>        date value
1 2003-01-01  1.17
2 2003-02-01  1.17
3 2003-03-01  1.13
4 2003-04-01  1.13
5 2003-05-01  1.07
6 2003-06-01  0.92</code></pre>
</div>
</div></li>
</ul>
<p>We once again include the monthly logarithmic return rates to our data frame:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>t_bill_df <span class="ot">&lt;-</span> t_bill_df <span class="sc">|&gt;</span> </span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transform</span>(<span class="at">return =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="fu">diff</span>(<span class="fu">log</span>(value))))</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a><span class="co">#view the first few rows with returns</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(t_bill_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>        date value      return
1 2003-01-01  1.17          NA
2 2003-02-01  1.17  0.00000000
3 2003-03-01  1.13 -0.03478612
4 2003-04-01  1.13  0.00000000
5 2003-05-01  1.07 -0.05455898
6 2003-06-01  0.92 -0.15104026</code></pre>
</div>
</div>
<p>Before moving on to the next task, we filter all (applicable) data sets to reflect the time frame of 2007-2023, keeping in mind our wage growth data was only able to go back to mid-2006. This adjustment aligns our data for further analysis.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co">#defining the date range</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>start_date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2007-01-01"</span>)</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>end_date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2023-12-31"</span>)</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a><span class="co">#adjusting wage growth dataframe</span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>wage_growth_df <span class="ot">&lt;-</span> <span class="fu">subset</span>(wage_growth_df, date <span class="sc">&gt;=</span> start_date <span class="sc">&amp;</span> date <span class="sc">&lt;=</span> end_date)</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a><span class="co">#adjusting CPI dataframe</span></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>cpi_df <span class="ot">&lt;-</span> <span class="fu">subset</span>(cpi_df, date <span class="sc">&gt;=</span> start_date <span class="sc">&amp;</span> date <span class="sc">&lt;=</span> end_date)</span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a><span class="co">#adjusting bond dataframe</span></span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>bond_df <span class="ot">&lt;-</span> <span class="fu">subset</span>(bond_df, date <span class="sc">&gt;=</span> start_date <span class="sc">&amp;</span> date <span class="sc">&lt;=</span> end_date)</span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a><span class="co">#adjusting T-bill dataframe</span></span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>t_bill_df <span class="ot">&lt;-</span> <span class="fu">subset</span>(t_bill_df, date <span class="sc">&gt;=</span> start_date <span class="sc">&amp;</span> date <span class="sc">&lt;=</span> end_date)</span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a><span class="co">#adjusting international equity dataframe</span></span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a>int_equity_monthly <span class="ot">&lt;-</span> <span class="fu">subset</span>(</span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a>    int_equity_monthly,</span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a>    date <span class="sc">&gt;=</span> start_date <span class="sc">&amp;</span> date <span class="sc">&lt;=</span> end_date</span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true" tabindex="-1"></a><span class="co">#verify each dataframe</span></span>
<span id="cb64-24"><a href="#cb64-24" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(</span>
<span id="cb64-25"><a href="#cb64-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">wage_growth =</span> <span class="fu">range</span>(wage_growth_df<span class="sc">$</span>date),</span>
<span id="cb64-26"><a href="#cb64-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">cpi =</span> <span class="fu">range</span>(cpi_df<span class="sc">$</span>date),</span>
<span id="cb64-27"><a href="#cb64-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">bond =</span> <span class="fu">range</span>(bond_df<span class="sc">$</span>date),</span>
<span id="cb64-28"><a href="#cb64-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">t_bill =</span> <span class="fu">range</span>(t_bill_df<span class="sc">$</span>date),</span>
<span id="cb64-29"><a href="#cb64-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">int_equity =</span> <span class="fu">range</span>(int_equity_monthly<span class="sc">$</span>date)</span>
<span id="cb64-30"><a href="#cb64-30" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$wage_growth
[1] "2007-01-01" "2023-12-01"

$cpi
[1] "2007-01-01" "2023-12-01"

$bond
[1] "2007-01-01" "2023-12-01"

$t_bill
[1] "2007-01-01" "2023-12-01"

$int_equity
[1] "2007-01-01" "2023-12-01"</code></pre>
</div>
</div>
</section>
<section id="task-4-initial-analysis" class="level2">
<h2 class="anchored" data-anchor-id="task-4-initial-analysis">Task 4: Initial Analysis</h2>
<p>This step involves conducting exploratory data analysis to identify key properties of the data historical data acquired.</p>
<p>The code below calculates the long-run monthly averages and variances for each data series.</p>
<p>The table above summarizes the key statistical properties, the long-run monthly averages, and the variability of each series over the 2007-2023 time period.</p>
<p>The <strong>wage growth</strong> shows a mean value of <strong>25.89</strong> and variance of <strong>13.74.</strong> This indicates a relatively stable upward trend over time.</p>
<p>The <strong>CPI</strong> exhibits the highest variance at <strong>697.58</strong>, indicates there were significant fluctuations in inflation from 2007 to 2023. This impacts our <u>retirement planning</u>, emphasizing the importance of considering inflation-indexed returns (like in our two retirement plan options).</p>
<p>Next, we generate the correlation matrix table through the code below. We first combine our data into a single data frame, <code>aligned_data</code>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a> <span class="co"># Renaming and preparing datasets for alignment</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>wage_growth_prepared <span class="ot">&lt;-</span> wage_growth_df <span class="sc">|&gt;</span> <span class="fu">rename</span>(<span class="at">wage_growth =</span> value)</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>cpi_prepared <span class="ot">&lt;-</span> cpi_df <span class="sc">|&gt;</span> <span class="fu">rename</span>(<span class="at">cpi =</span> value)</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>bond_prepared <span class="ot">&lt;-</span> bond_df <span class="sc">|&gt;</span> <span class="fu">rename</span>(<span class="at">bond_return =</span> return) <span class="sc">|&gt;</span> <span class="fu">select</span>(date, bond_return)</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>t_bill_prepared <span class="ot">&lt;-</span> t_bill_df <span class="sc">|&gt;</span> <span class="fu">rename</span>(<span class="at">t_bill_return =</span> return) <span class="sc">|&gt;</span> <span class="fu">select</span>(date, t_bill_return)</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure int_equity_monthly has the correct structure</span></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>int_equity_prepared <span class="ot">&lt;-</span> int_equity_monthly </span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">head</span>(int_equity_monthly))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
  int_equity date      
       &lt;dbl&gt; &lt;date&gt;    
1       204. 2007-01-01
2       206. 2007-02-01
3       207. 2007-03-01
4       208. 2007-04-01
5       209. 2007-05-01
6       207. 2007-06-01</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine all datasets by date using a full join</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>aligned_data <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>  wage_growth_prepared,</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>  cpi_prepared,</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>  bond_prepared,</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>  t_bill_prepared,</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>  int_equity_prepared</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span> </span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reduce</span>(full_join, <span class="at">by =</span> <span class="st">"date"</span>)</span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Check structure and preview</span></span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(aligned_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   204 obs. of  6 variables:
 $ date         : Date, format: "2007-01-01" "2007-02-01" ...
 $ wage_growth  : num  20.6 20.7 20.7 20.8 20.8 ...
 $ cpi          : num  203 204 205 206 207 ...
 $ bond_return  : num  0.04293 -0.00844 -0.03449 0.02811 0.01271 ...
 $ t_bill_return: num  0.02645 0.00999 -0.01805 -0.01427 -0.02917 ...
 $ int_equity   : num  204 206 207 208 209 ...</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(aligned_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>        date wage_growth     cpi  bond_return t_bill_return int_equity
1 2007-01-01       20.59 203.437  0.042925045   0.026451186   204.1070
2 2007-02-01       20.68 204.226 -0.008438869   0.009990093   205.5720
3 2007-03-01       20.73 205.288 -0.034486176  -0.018054653   207.4839
4 2007-04-01       20.78 205.904  0.028109959  -0.014271394   208.4286
5 2007-05-01       20.84 206.755  0.012712036  -0.029168735   209.3670
6 2007-06-01       20.95 207.234  0.071095922  -0.025697345   207.2132</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Recompute summary statistics for aligned data</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>mean_stats <span class="ot">&lt;-</span> aligned_data <span class="sc">|&gt;</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Wage Growth</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">mean</span>(wage_growth, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">CPI</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">mean</span>(cpi, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Bond Returns</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">mean</span>(bond_return, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">T-Bill Returns</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">mean</span>(t_bill_return, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">International Equity</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">mean</span>(int_equity, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">everything</span>(),</span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"Data Metric"</span>,</span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"Mean Value"</span></span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a>variance_stats <span class="ot">&lt;-</span> aligned_data <span class="sc">|&gt;</span></span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Wage Growth</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">var</span>(wage_growth, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb72-19"><a href="#cb72-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">CPI</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">var</span>(cpi, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb72-20"><a href="#cb72-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Bond Returns</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">var</span>(bond_return, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb72-21"><a href="#cb72-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">T-Bill Returns</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">var</span>(t_bill_return, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb72-22"><a href="#cb72-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">International Equity</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">var</span>(int_equity, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb72-23"><a href="#cb72-23" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb72-24"><a href="#cb72-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb72-25"><a href="#cb72-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">everything</span>(),</span>
<span id="cb72-26"><a href="#cb72-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"Data Metric"</span>,</span>
<span id="cb72-27"><a href="#cb72-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"Variance"</span></span>
<span id="cb72-28"><a href="#cb72-28" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb72-29"><a href="#cb72-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-30"><a href="#cb72-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine means and variances</span></span>
<span id="cb72-31"><a href="#cb72-31" aria-hidden="true" tabindex="-1"></a>summary_stats_aligned <span class="ot">&lt;-</span> mean_stats <span class="sc">|&gt;</span></span>
<span id="cb72-32"><a href="#cb72-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(variance_stats, <span class="at">by =</span> <span class="st">"Data Metric"</span>)</span>
<span id="cb72-33"><a href="#cb72-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-34"><a href="#cb72-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the summary statistics using the gt package</span></span>
<span id="cb72-35"><a href="#cb72-35" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)</span>
<span id="cb72-36"><a href="#cb72-36" aria-hidden="true" tabindex="-1"></a>summary_stats_aligned <span class="sc">|&gt;</span></span>
<span id="cb72-37"><a href="#cb72-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span></span>
<span id="cb72-38"><a href="#cb72-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_header</span>(</span>
<span id="cb72-39"><a href="#cb72-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Updated Summary Statistics for Aligned Data"</span>,</span>
<span id="cb72-40"><a href="#cb72-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Averages and Variances from 2007 to 2023"</span></span>
<span id="cb72-41"><a href="#cb72-41" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb72-42"><a href="#cb72-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_number</span>(</span>
<span id="cb72-43"><a href="#cb72-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="fu">vars</span>(<span class="st">`</span><span class="at">Mean Value</span><span class="st">`</span>, Variance),</span>
<span id="cb72-44"><a href="#cb72-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">decimals =</span> <span class="dv">2</span></span>
<span id="cb72-45"><a href="#cb72-45" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Since gt v0.3.0, `columns = vars(...)` has been deprecated.
• Please use `columns = c(...)` instead.</code></pre>
</div>
<div class="cell-output-display">
<div id="vaqhgvvvas" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#vaqhgvvvas table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#vaqhgvvvas thead, #vaqhgvvvas tbody, #vaqhgvvvas tfoot, #vaqhgvvvas tr, #vaqhgvvvas td, #vaqhgvvvas th {
  border-style: none;
}

#vaqhgvvvas p {
  margin: 0;
  padding: 0;
}

#vaqhgvvvas .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#vaqhgvvvas .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#vaqhgvvvas .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#vaqhgvvvas .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#vaqhgvvvas .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#vaqhgvvvas .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#vaqhgvvvas .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#vaqhgvvvas .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#vaqhgvvvas .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#vaqhgvvvas .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#vaqhgvvvas .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#vaqhgvvvas .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#vaqhgvvvas .gt_spanner_row {
  border-bottom-style: hidden;
}

#vaqhgvvvas .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#vaqhgvvvas .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#vaqhgvvvas .gt_from_md > :first-child {
  margin-top: 0;
}

#vaqhgvvvas .gt_from_md > :last-child {
  margin-bottom: 0;
}

#vaqhgvvvas .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#vaqhgvvvas .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#vaqhgvvvas .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#vaqhgvvvas .gt_row_group_first td {
  border-top-width: 2px;
}

#vaqhgvvvas .gt_row_group_first th {
  border-top-width: 2px;
}

#vaqhgvvvas .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#vaqhgvvvas .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#vaqhgvvvas .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#vaqhgvvvas .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#vaqhgvvvas .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#vaqhgvvvas .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#vaqhgvvvas .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#vaqhgvvvas .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#vaqhgvvvas .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#vaqhgvvvas .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#vaqhgvvvas .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#vaqhgvvvas .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#vaqhgvvvas .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#vaqhgvvvas .gt_left {
  text-align: left;
}

#vaqhgvvvas .gt_center {
  text-align: center;
}

#vaqhgvvvas .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#vaqhgvvvas .gt_font_normal {
  font-weight: normal;
}

#vaqhgvvvas .gt_font_bold {
  font-weight: bold;
}

#vaqhgvvvas .gt_font_italic {
  font-style: italic;
}

#vaqhgvvvas .gt_super {
  font-size: 65%;
}

#vaqhgvvvas .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#vaqhgvvvas .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#vaqhgvvvas .gt_indent_1 {
  text-indent: 5px;
}

#vaqhgvvvas .gt_indent_2 {
  text-indent: 10px;
}

#vaqhgvvvas .gt_indent_3 {
  text-indent: 15px;
}

#vaqhgvvvas .gt_indent_4 {
  text-indent: 20px;
}

#vaqhgvvvas .gt_indent_5 {
  text-indent: 25px;
}

#vaqhgvvvas .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#vaqhgvvvas div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_heading">
<th colspan="3" class="gt_heading gt_title gt_font_normal">Updated Summary Statistics for Aligned Data</th>
</tr>
<tr class="odd gt_heading">
<th colspan="3" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border">Averages and Variances from 2007 to 2023</th>
</tr>
<tr class="header gt_col_headings">
<th id="Data-Metric" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Data Metric</th>
<th id="Mean-Value" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Mean Value</th>
<th id="Variance" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Variance</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="Data Metric">Wage Growth</td>
<td class="gt_row gt_right" headers="Mean Value">25.89</td>
<td class="gt_row gt_right" headers="Variance">13.74</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Data Metric">CPI</td>
<td class="gt_row gt_right" headers="Mean Value">243.26</td>
<td class="gt_row gt_right" headers="Variance">697.58</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Data Metric">Bond Returns</td>
<td class="gt_row gt_right" headers="Mean Value">0.00</td>
<td class="gt_row gt_right" headers="Variance">0.01</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Data Metric">T-Bill Returns</td>
<td class="gt_row gt_right" headers="Mean Value">0.00</td>
<td class="gt_row gt_right" headers="Variance">0.16</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Data Metric">International Equity</td>
<td class="gt_row gt_right" headers="Mean Value">337.20</td>
<td class="gt_row gt_right" headers="Variance">6,754.06</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Next, to analyze the relationships between the various economic indicators in our dataset, we compute a correlation matrix and visualize it using a heatmap. The correlation matrix tells us the strength and direction of linear relationship between each variable pair.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co">#compute correlation matrix</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>cor_matrix <span class="ot">&lt;-</span> <span class="fu">cor</span>(aligned_data[, <span class="sc">-</span><span class="dv">1</span>], <span class="at">use =</span> <span class="st">"complete.obs"</span>)</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="co">#reshape correlation matrix into long format for ggplot</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>cor_long <span class="ot">&lt;-</span> <span class="fu">melt</span>(cor_matrix)</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a><span class="co"># creating heatmap </span></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cor_long, <span class="fu">aes</span>(<span class="at">x =</span> Var1, <span class="at">y =</span> Var2, <span class="at">fill =</span> value)) <span class="sc">+</span></span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span> <span class="co"># Add gridlines for better separation</span></span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient2</span>(</span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">low =</span> <span class="st">"blue"</span>, <span class="at">high =</span> <span class="st">"red"</span>, <span class="at">mid =</span> <span class="st">"white"</span>,</span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">midpoint =</span> <span class="dv">0</span>, <span class="at">limit =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>), <span class="at">space =</span> <span class="st">"Lab"</span>,</span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Correlation"</span></span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb74-17"><a href="#cb74-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb74-18"><a href="#cb74-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb74-19"><a href="#cb74-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>()</span>
<span id="cb74-20"><a href="#cb74-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb74-21"><a href="#cb74-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(</span>
<span id="cb74-22"><a href="#cb74-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Correlation Matrix Heatmap"</span>,</span>
<span id="cb74-23"><a href="#cb74-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Relationships Between Economic Indicators"</span></span>
<span id="cb74-24"><a href="#cb74-24" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The heatmap visualizes the correlations among the economic indicators. We see a <strong>strong positive correlation</strong> between wage growth and CIP, indicating that as wages increase, consumer prices tend to rise, which aligns with inflationary trends. Differently, we find a <strong>weak positive correlation</strong> between T-bill returns and other indicators like bond returns and international equities. This highlights the more stable and less market-sensitive nature of these economic indicators.</p>
</section>
<section id="task-5-historical-comparison" class="level2">
<h2 class="anchored" data-anchor-id="task-5-historical-comparison">Task 5: Historical Comparison</h2>
</section>
<section id="task-6-fixed-rate-analysis" class="level2">
<h2 class="anchored" data-anchor-id="task-6-fixed-rate-analysis">Task 6: Fixed-Rate Analysis</h2>
</section>
<section id="task-7-monte-carlo-analysis" class="level2">
<h2 class="anchored" data-anchor-id="task-7-monte-carlo-analysis">Task 7: Monte Carlo Analysis</h2>
<section id="recommendation" class="level3">
<h3 class="anchored" data-anchor-id="recommendation"><u>Recommendation</u></h3>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/chricannon\.github\.io\/STA9750-2024-FALL\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>